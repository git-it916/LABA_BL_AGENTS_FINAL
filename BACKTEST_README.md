# Black-Litterman í¬íŠ¸í´ë¦¬ì˜¤ ë°±í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” LLM(Llama 3)ì„ ì‚¬ìš©í•˜ì—¬ ì„¹í„° ë·°ë¥¼ ìë™ ìƒì„±í•˜ê³ , Black-Litterman ëª¨ë¸ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìµœì í™”í•œ í›„ ë°±í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1ï¸âƒ£ ë‹¨ì¼ ì‹œì  ë°±í…ŒìŠ¤íŠ¸ (`run_single.py`)

**íŠ¹ì • ë‚ ì§œ í•œ ì‹œì **ì— ëŒ€í•´ LLM ë·° ìƒì„± â†’ BL ìµœì í™” â†’ ë°±í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

#### ì‹¤í–‰

```bash
python run_single.py
```

#### ëŒ€í™”í˜• ì…ë ¥

1. **ì‹œë®¬ë ˆì´ì…˜ ì´ë¦„**: ê²°ê³¼ íŒŒì¼ ì´ë¦„ (ì˜ˆ: `my_test`)
2. **Tier ì„ íƒ**:
   - `1`: ê¸°ìˆ ì  ì§€í‘œë§Œ (CAGR, ì¶”ì„¸, ë³€ë™ì„± ë“±)
   - `2`: ê¸°ìˆ ì  + íšŒê³„ ì§€í‘œ (ROE, P/E ë“±)
   - `3`: ëª¨ë“  ì§€í‘œ (ê¸°ìˆ ì  + íšŒê³„ + ê±°ì‹œê²½ì œ)
3. **ì˜ˆì¸¡ ë‚ ì§œ**: YYYY-MM-DD í˜•ì‹ (ì˜ˆ: `2024-05-31`)
4. **tau ê°’**: BL ë¶ˆí™•ì‹¤ì„± ê³„ìˆ˜ (ê¸°ë³¸ê°’ `0.025`)

#### ì¶œë ¥ ì˜ˆì‹œ

```
==================================================
3ë‹¨ê³„: ê²°ê³¼ ë¶„ì„
==================================================

[ê²°ê³¼] 20 ì˜ì—…ì¼ ëˆ„ì  ìˆ˜ìµë¥ :
             MVO_Performance  BL_AI_Performance
BusinessDay
1                  -0.077285          -0.002302
2                  -0.069397           0.002979
...
20                  0.338387           0.006975

[ìš”ì•½]
  MVO ë²¤ì¹˜ë§ˆí¬ ìµœì¢… ìˆ˜ìµë¥ : 33.84%
  BL-AI í¬íŠ¸í´ë¦¬ì˜¤ ìµœì¢… ìˆ˜ìµë¥ : 0.70%
  ì´ˆê³¼ ìˆ˜ìµë¥ : -33.14%
```

#### ê²°ê³¼ ì €ì¥ ìœ„ì¹˜

```
database/logs/Tier{N}/result_of_test/{ì‹œë®¬ë ˆì´ì…˜ì´ë¦„}_single_backtest.json
```

---

### 2ï¸âƒ£ ë‹¤ì¤‘ ì‹œì  ë°°ì¹˜ ë°±í…ŒìŠ¤íŠ¸ (`run_batch.py`)

**ì—¬ëŸ¬ ë‚ ì§œ**ì— ëŒ€í•´ ìë™ìœ¼ë¡œ ë°˜ë³µ ì‹¤í–‰í•˜ê³ , **í‰ê·  ì„±ê³¼**ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

#### ì‹¤í–‰

```bash
python run_batch.py
```

#### ëŒ€í™”í˜• ì…ë ¥

1. **ì‹œë®¬ë ˆì´ì…˜ ì´ë¦„**: ê²°ê³¼ íŒŒì¼ ì´ë¦„ (ì˜ˆ: `batch_2024`)
2. **Tier ì„ íƒ**: `1`, `2`, `3` ì¤‘ ì„ íƒ
3. **ì‹œì‘ ë‚ ì§œ**: YYYY-MM-DD í˜•ì‹ (ì˜ˆ: `2024-04-30`)
4. **ì¢…ë£Œ ë‚ ì§œ**: YYYY-MM-DD í˜•ì‹ (ì˜ˆ: `2024-11-30`)
   - ì‹œì‘~ì¢…ë£Œ ì‚¬ì´ì˜ ëª¨ë“  ì›”ë§ ë‚ ì§œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤
5. **tau ê°’**: BL ë¶ˆí™•ì‹¤ì„± ê³„ìˆ˜ (ê¸°ë³¸ê°’ `0.025`)

#### ì¶œë ¥ ì˜ˆì‹œ

```
==================================================
3ë‹¨ê³„: í‰ê·  ì„±ê³¼ ë¶„ì„
==================================================

[ê²°ê³¼] ì´ 8ê°œ ì‹œì  ë°±í…ŒìŠ¤íŠ¸ ì™„ë£Œ

============================================================
ì§€í‘œ                           MVO ë²¤ì¹˜ë§ˆí¬       BL-AI í¬íŠ¸í´ë¦¬ì˜¤
============================================================
í‰ê·  20ì¼ ëˆ„ì  ìˆ˜ìµë¥               12.45%            15.67%
í‘œì¤€í¸ì°¨                           5.32%             6.78%
============================================================
í‰ê·  ì´ˆê³¼ ìˆ˜ìµë¥                     3.22%
ìŠ¹ë¥  (BL-AI > MVO)                 62.5%
============================================================

[ì„±ê³µ] BL-AI í¬íŠ¸í´ë¦¬ì˜¤ê°€ í‰ê· ì ìœ¼ë¡œ ë²¤ì¹˜ë§ˆí¬ë¥¼ 3.22%p ì´ˆê³¼ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!

============================================================
ì‹œì ë³„ ìƒì„¸ ê²°ê³¼
============================================================
ì˜ˆì¸¡ ë‚ ì§œ     MVO ìˆ˜ìµë¥    BL ìˆ˜ìµë¥     ì´ˆê³¼ ìˆ˜ìµë¥ 
--------------------------------------------------------------------------------
2024-04-30       10.23%      12.45%       2.22%
2024-05-31       11.34%      14.56%       3.22%
2024-06-30       13.45%      16.78%       3.33%
...
```

#### ê²°ê³¼ ì €ì¥ ìœ„ì¹˜

```
database/logs/Tier{N}/result_of_test/{ì‹œë®¬ë ˆì´ì…˜ì´ë¦„}_batch_backtest.json
```

---

## ğŸ“Š ê²°ê³¼ JSON íŒŒì¼ êµ¬ì¡°

### ë‹¨ì¼ ì‹œì  (`_single_backtest.json`)

```json
{
  "simulation_name": "my_test",
  "tier": 1,
  "forecast_date": "2024-05-31",
  "tau": 0.025,
  "backtest_period": {
    "start": "2024-06-01",
    "end": "2024-06-30"
  },
  "summary": {
    "mvo_final_return": 0.3384,
    "bl_final_return": 0.0070,
    "outperformance": -0.3314
  },
  "mvo_performance": { "daily_returns": {...} },
  "bl_performance": { "daily_returns": {...} }
}
```

### ë‹¤ì¤‘ ì‹œì  (`_batch_backtest.json`)

```json
{
  "simulation_name": "batch_2024",
  "tier": 1,
  "tau": 0.025,
  "num_periods": 8,
  "period_range": {
    "start": "2024-04-30",
    "end": "2024-11-30"
  },
  "average_performance": {
    "mvo_mean_return": 0.1245,
    "mvo_std_return": 0.0532,
    "bl_mean_return": 0.1567,
    "bl_std_return": 0.0678,
    "mean_outperformance": 0.0322,
    "win_rate": 62.5
  },
  "detailed_results": [
    {
      "forecast_date": "2024-04-30",
      "mvo_final_return": 0.1023,
      "bl_final_return": 0.1245,
      "outperformance": 0.0222
    },
    ...
  ]
}
```

---

## âš™ï¸ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

1. **GPU (NVIDIA CUDA)**
   - Llama 3 8B ëª¨ë¸ì€ GPU ì—†ì´ ì‹¤í–‰ ë¶ˆê°€
   - ìµœì†Œ 8GB VRAM ê¶Œì¥

2. **Python íŒ¨í‚¤ì§€**
   ```bash
   pip install -r requirements.txt
   ```

3. **ë°ì´í„° íŒŒì¼**
   - `database/final_stock_daily.parquet`: ì¼ì¼ ì£¼ì‹ ë°ì´í„°
   - `database/final_stock_months.parquet`: ì›”ë³„ ì£¼ì‹ ë°ì´í„°
   - `database/compustat_2021.01_2024.12.csv`: íšŒê³„ ë°ì´í„°
   - `database/DTB3.csv`: ë¬´ìœ„í—˜ ìˆ˜ìµë¥ 

### ì˜ˆìƒ ì†Œìš” ì‹œê°„

- **ë‹¨ì¼ ì‹œì **: ì•½ 2~5ë¶„ (GPU ì„±ëŠ¥ì— ë”°ë¼)
- **ë°°ì¹˜ ì‹¤í–‰**: ì‹œì ë‹¹ ì•½ 2~5ë¶„
  - 8ê°œ ì‹œì  = ì•½ 16~40ë¶„

---

## ğŸ” ì›Œí¬í”Œë¡œìš°

### ë‹¨ì¼ ì‹œì  (`run_single.py`)

```
1. ì‚¬ìš©ì ì…ë ¥
   â†“
2. LLM ë·° ìƒì„± (Llama 3)
   - Tier 1: ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„
   - Tier 2: + íšŒê³„ ì§€í‘œ
   - Tier 3: + ê±°ì‹œê²½ì œ ì§€í‘œ
   â†“
3. Black-Litterman ìµœì í™”
   - ì‹œì¥ ê· í˜• ìˆ˜ìµë¥  ê³„ì‚° (Ï€)
   - ë·° ë§¤ê°œë³€ìˆ˜ ìƒì„± (P, Q, Î©)
   - BL ìˆ˜ìµë¥  ê³„ì‚° (Î¼_BL)
   â†“
4. Mean-Variance Optimization
   - Sharpe Ratio ìµœëŒ€í™”
   - Tangency í¬íŠ¸í´ë¦¬ì˜¤ ê³„ì‚°
   â†“
5. ë°±í…ŒìŠ¤íŠ¸ (20 ì˜ì—…ì¼)
   - MVO ë²¤ì¹˜ë§ˆí¬ vs BL-AI í¬íŠ¸í´ë¦¬ì˜¤
   - ì¼ë³„ ìˆ˜ìµë¥  ê³„ì‚°
   â†“
6. ê²°ê³¼ ì €ì¥ (JSON)
```

### ë°°ì¹˜ ì‹¤í–‰ (`run_batch.py`)

```
1. ì‚¬ìš©ì ì…ë ¥ (ì‹œì‘~ì¢…ë£Œ ë‚ ì§œ)
   â†“
2. ì›”ë§ ë‚ ì§œ ìë™ ìƒì„±
   â†“
3. ëª¨ë“  ì‹œì ì— ëŒ€í•´ í•œ ë²ˆì— LLM ë·° ìƒì„±
   â†“
4. ê° ì‹œì ë³„ ë°˜ë³µ:
   - BL ìµœì í™”
   - ë°±í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
   â†“
5. í†µê³„ ê³„ì‚°:
   - í‰ê·  ìˆ˜ìµë¥ 
   - í‘œì¤€í¸ì°¨
   - ìŠ¹ë¥ 
   - ì´ˆê³¼ ìˆ˜ìµë¥ 
   â†“
6. ê²°ê³¼ ì €ì¥ (JSON)
```

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: 2024ë…„ 5ì›” ë‹¨ì¼ ì‹œì  í…ŒìŠ¤íŠ¸

```bash
python run_single.py
```

ì…ë ¥:
```
ì‹œë®¬ë ˆì´ì…˜ ì´ë¦„: test_may_2024
Tier: 2
ì˜ˆì¸¡ ë‚ ì§œ: 2024-05-31
tau: 0.025
```

### ì˜ˆì‹œ 2: 2024ë…„ 4ì›”~11ì›” ë°°ì¹˜ í…ŒìŠ¤íŠ¸

```bash
python run_batch.py
```

ì…ë ¥:
```
ì‹œë®¬ë ˆì´ì…˜ ì´ë¦„: batch_2024_h2
Tier: 2
ì‹œì‘ ë‚ ì§œ: 2024-04-30
ì¢…ë£Œ ë‚ ì§œ: 2024-11-30
tau: 0.025
```

ê²°ê³¼: 8ê°œ ì‹œì  (4ì›”~11ì›”)ì— ëŒ€í•œ í‰ê·  ì„±ê³¼ ê³„ì‚°

---

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. GPU ì˜¤ë¥˜

```
[ì¹˜ëª…ì  ì˜¤ë¥˜] GPUë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
```

**í•´ê²°**:
- CUDAê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- PyTorch CUDA ë²„ì „ ì„¤ì¹˜:
  ```bash
  pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
  ```

### 2. ë°ì´í„° íŒŒì¼ ì—†ìŒ

```
ì˜¤ë¥˜: 'database/final_stock_daily.parquet' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
```

**í•´ê²°**:
- `database/` í´ë”ì— í•„ìš”í•œ ë°ì´í„° íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
- ë°ì´í„° ì „ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

### 3. ë©”ëª¨ë¦¬ ë¶€ì¡±

```
CUDA out of memory
```

**í•´ê²°**:
- ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
- ë°°ì¹˜ í¬ê¸°ê°€ ì‘ì€ ë‹¤ë¥¸ LLM ëª¨ë¸ ê³ ë ¤
- ë” í° VRAMì˜ GPU ì‚¬ìš©

---

## ğŸ“š ì°¸ê³  ìë£Œ

- **í”„ë¡œì íŠ¸ ë¬¸ì„œ**: [`CLAUDE.md`](CLAUDE.md)
- **Black-Litterman ëª¨ë¸**: He & Litterman (1999)
- **Llama 3**: Meta AI

---

## ğŸ“§ ë¬¸ì˜

- GitHub Issues: [í”„ë¡œì íŠ¸ ì´ìŠˆ í˜ì´ì§€]
- LABA: Lab for Accounting Big Data & Artificial Intelligence

---

*Last Updated: 2025-11-12*
