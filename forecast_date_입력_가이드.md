# 📅 forecast_date 입력 가이드

## ✅ 수정 완료!

**투자 로직 변경:**
- **이전**: `backtest_date + 1일`부터 투자 (다음 달로 넘어감)
- **현재**: `learning_date + 1개월의 1일`부터 투자 (같은 달 유지)

---

## 🎯 입력 방법

### 원하는 투자 시작일에 따른 입력값

| 투자 시작일 | 학습 종료일 | forecast_date 입력 |
|------------|------------|-------------------|
| 2024-05-01 | 2024-04-30 | `24-05-31`       |
| 2024-06-01 | 2024-05-31 | `24-06-30`       |
| 2024-07-01 | 2024-06-30 | `24-07-31`       |
| 2024-08-01 | 2024-07-31 | `24-08-31`       |
| 2024-09-01 | 2024-08-31 | `24-09-30`       |
| 2024-10-01 | 2024-09-30 | `24-10-31`       |
| 2024-11-01 | 2024-10-31 | `24-11-30`       |
| 2024-12-01 | 2024-11-30 | `24-12-31`       |

---

## 📝 규칙

**간단한 공식:**
```
forecast_date 입력 = 투자하려는 달의 월말
```

**예시:**
- 5월에 투자하고 싶다 → `24-05-31` 입력
- 12월에 투자하고 싶다 → `24-12-31` 입력

---

## 💡 실행 예시

### run_batch.py 실행 시

```
백테스트 시작 달을 입력하세요 (월말 날짜, 예: 2024-05-31 = 5월 백테스트): 2024-05-31
백테스트 종료 달을 입력하세요 (월말 날짜, 예: 2024-11-30 = 11월까지 백테스트): 2024-12-31
```

**결과:**
- 2024-05-31 입력 → 4월 30일까지 학습 → 5월 1일부터 투자
- 2024-06-30 입력 → 5월 31일까지 학습 → 6월 1일부터 투자
- ...
- 2024-12-31 입력 → 11월 30일까지 학습 → 12월 1일부터 투자

---

## 🔍 내부 동작

### 시스템 처리 흐름

```python
# 입력: forecast_period = ['24-05-31', '24-06-30', ..., '24-12-31']

# 1. get_rolling_dates()가 처리
forecast_date = 2024-05-31
end_date = 2024-04-30  # 1개월 전 (학습 종료일)
start_date = 2014-05-31  # 10년 전 (학습 시작일)

# 2. BL 최적화
학습 기간: 2014-05-31 ~ 2024-04-30
가중치 저장: forecast_date = 2024-05-31

# 3. 백테스트 (✅ 수정됨)
learning_date = 2024-04-30
invest_start = (2024-04-30 + 1개월).replace(day=1) = 2024-05-01
invest_end = 2024-05-01 + 70일 = 2024-07-10

# 4. 성과 측정
2024-05-01부터 20 거래일 동안의 수익률 계산
```

---

## ⚠️ 주의사항

### 12월 백테스트 가능!

**이제 12월 백테스트가 정상 작동합니다:**
```
입력: 24-12-31
학습: ~ 2024-11-30
투자: 2024-12-01 ~ (20 거래일)
필요 데이터: ~ 2024-12-31 ✅ (존재함!)
```

### 데이터 범위 확인

현재 사용 가능한 일별 데이터:
- **시작**: 2024-05-01
- **종료**: 2024-12-31

따라서 백테스트 가능한 범위:
- **최소**: 2024-05-31 입력 (5월 투자)
- **최대**: 2024-12-31 입력 (12월 투자)

---

## 🎬 실제 사용 예시

### 5월 ~ 12월 전체 백테스트

```bash
python run_batch.py
```

**입력:**
```
시뮬레이션 이름: test_may_to_dec
Tier: 2
백테스트 시작 달: 2024-05-31
백테스트 종료 달: 2024-12-31
tau: 0.025
백테스트 기간: 20
```

**처리되는 시점:**
1. 2024-05-31 → 4월 데이터 학습 → 5월 투자
2. 2024-06-30 → 5월 데이터 학습 → 6월 투자
3. 2024-07-31 → 6월 데이터 학습 → 7월 투자
4. 2024-08-31 → 7월 데이터 학습 → 8월 투자
5. 2024-09-30 → 8월 데이터 학습 → 9월 투자
6. 2024-10-31 → 9월 데이터 학습 → 10월 투자
7. 2024-11-30 → 10월 데이터 학습 → 11월 투자
8. 2024-12-31 → 11월 데이터 학습 → 12월 투자

**총 8개 시점 백테스트 완료!** 🎉

---

## 🧪 테스트 방법

간단한 테스트:

```python
import pandas as pd
from datetime import timedelta

# 입력값
forecast_period = ['24-05-31']
learning_date = pd.Timestamp('2024-04-30')

# 투자 시작일 계산
invest_start = (learning_date + pd.DateOffset(months=1)).replace(day=1)

print(f"학습 종료일: {learning_date.date()}")
print(f"투자 시작일: {invest_start.date()}")
# 출력:
# 학습 종료일: 2024-04-30
# 투자 시작일: 2024-05-01 ✅
```

---

**수정 완료 일시**: 2025-11-18
**수정 파일**: `run_batch.py` (라인 194-197)
